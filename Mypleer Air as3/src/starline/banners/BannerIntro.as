package starline.banners { 		import flash.display.Sprite;  	import fl.containers.UILoader;	import flash.utils.Timer;	import flash.events.TimerEvent;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.net.URLLoader;	import fl.controls.Button;	import flash.net.URLRequest;	import flash.text.TextField;	import flash.text.TextFieldAutoSize;	import flash.net.navigateToURL;	import flash.display.MovieClip;	import flash.display.BlendMode;	import flash.events.IOErrorEvent;	import flash.text.TextFormat;	import org.bytearray.gif.player.GIFPlayer;  	public class BannerIntro extends Sprite {  		//vars		private var xmlLoader:URLLoader = new URLLoader();		private var button:Button = new Button(); 		private var mybanner:UILoader = new UILoader();		private var waittext:TextField= new TextField();		private var banner_source:String;		private var banner_link:String;		private var banner_waittext:String;		private var banner_buttontext:String;		private var banner_type:String;		private var banner_width:Number;		private var banner_height:Number;		private var banner_time:Number;		private var banner_bgcolor:Number;  		public function BannerIntro(url:String,appid:Number,userid:String) {			// Setup XML Loader			xmlLoader.load(new URLRequest(url+'/banner_xml.php?appid='+appid+"&userid="+userid));			xmlLoader.addEventListener(Event.COMPLETE , processXML);			xmlLoader.addEventListener(IOErrorEvent.IO_ERROR, errorHandler); 			mybanner.buttonMode=true;			mybanner.scaleContent=false;			mybanner.useHandCursor=true; 			button.width=150;			button.height=50;			button.visible=false;			button.label='Перейти к приложению';			this.graphics.beginFill(0xFFFFFF);			this.graphics.drawRect(0,0,1400, 1400);			this.addChild(button);				this.addChild(waittext);			this.addChild(mybanner);			waittext.autoSize=TextFieldAutoSize.CENTER;			waittext.blendMode= BlendMode.INVERT;		}				private function errorHandler(e:IOErrorEvent):void {			this.parent.removeChild(this);			trace( "Had problem loading the XML File.");				  		}		private function processXML(e:Event):void {			// Load XML data			XML.ignoreWhitespace = true;			var Collections:XML = new XML(e.target.data);				if (Collections.source.length()){				banner_source = Collections.source[0];				mybanner.source=banner_source;			}			if (Collections.link.length()){				banner_link =  Collections.link[0];			}			if (Collections.width.length()){				banner_width = Collections.width[0];				mybanner.width = banner_width;			}			if (Collections.height.length()){				banner_height = Collections.height[0];				mybanner.height = banner_height;			}			if (Collections.time.length()){				banner_time = Collections.time[0];			}			else {				banner_time = 5000;			}			if (Collections.bgcolor.length()){				banner_bgcolor = Collections.bgcolor[0];				this.graphics.beginFill(banner_bgcolor);				this.graphics.drawRect(0,0,stage.stageWidth,stage.stageHeight);			}			if (Collections.waittext.length()){				banner_waittext = Collections.waittext[0];				waittext.htmlText=banner_waittext;				var my_fmt:TextFormat = new TextFormat();				my_fmt.bold=true;				my_fmt.color=0xFFFFFF-banner_bgcolor;				my_fmt.font="Arial";				my_fmt.size=20;				my_fmt.align="center";				waittext.setTextFormat(my_fmt);									}			if (Collections.buttontext.length()){				banner_buttontext  = Collections.buttontext[0];				button.label=banner_buttontext;			}			if (Collections.banner_type.length()){				banner_type  = Collections.banner_type[0];			} 			 			mybanner.x = (stage.stageWidth - banner_width)/2;			mybanner.y = (stage.stageHeight - banner_height - button.height)/2;			var mc:MovieClip = new MovieClip();			mc.graphics.beginFill(0xFF0000);			mc.graphics.drawRect(0,0,banner_width,banner_height);			mc.graphics.endFill();			mc.x = mybanner.x;			mc.y = mybanner.y;			mybanner.mask=mc;			mybanner.addEventListener(MouseEvent.CLICK,  banner_click);		  			if (banner_type == 'image/gif'){				var player:GIFPlayer = new GIFPlayer();				player.load(new URLRequest(banner_source)); 				mybanner.addChild(player);			}else{				mybanner.load();				}				button.x=(stage.stageWidth - button.width)/2;			button.y = 10;					waittext.x=(stage.stageWidth - waittext.width)/2;			waittext.y = 10;					var myTimer:Timer = new Timer(banner_time, 1);			myTimer.addEventListener(TimerEvent.TIMER_COMPLETE, completeHandler);			myTimer.start();		}  		private function banner_click(e:MouseEvent):void{			navigateToURL(new URLRequest(banner_link), '_blank');		}  		private function completeHandler(e:TimerEvent):void {			button.visible = true; 			waittext.visible = false;			button.addEventListener(MouseEvent.CLICK,close_all);		}  		private function close_all(e:MouseEvent):void{			this.parent.removeChild(this);		}	}}	